<div id="disqus_thread"></div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    var disqusObserver = new IntersectionObserver(function(entries) {
        if (entries[0].isIntersecting) {
            var d = document, s = d.createElement('script');
            s.src = 'https://{{ site.comments.disqus.shortname }}.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            disqusObserver.disconnect();
        }
    });
    disqusObserver.observe(document.getElementById('disqus_thread'));
});

  /* Auto switch theme */

  function reloadDisqus() {
    /* Disqus hasn't been loaded */
    if (typeof DISQUS === "undefined") {
      return;
    }

    if (document.readyState == 'complete') {
      DISQUS.reset({ reload: true, config: disqus_config });
    }
  }

  const modeToggle = document.querySelector(".mode-toggle");

  if (typeof modeToggle !== "undefined") {
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus);
  }
</script>
